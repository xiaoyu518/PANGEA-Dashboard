<!DOCTYPE html>
<html>
  <head>
    <title>Legend Interaction Test</title>

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <style media="screen">
      .vega-actions a {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
	<div id="vis"></div>
    <script type="text/javascript">
    	// Assign the specification to a local variable vlSpec.
    	var vlSpec = {
			"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "title": "Popart Skygrid",
            "width": 600, "height": 400,
            "data": {
                "values": [
                        {"Date": "2020", "Mean": 22996.9678, "Upper": 60604.5768, "Lower": 8909.6445, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2019", "Mean": 44662.7696, "Upper": 69223.5964, "Lower": 27857.1682, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2018", "Mean": 60666.3703, "Upper": 92793.9522, "Lower": 40950.3967, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2017", "Mean": 64950.53, "Upper": 104353.3193, "Lower": 39305.392, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2016", "Mean": 49369.9505, "Upper": 79227.2118, "Lower": 31649.2997, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2015", "Mean": 61294.0659, "Upper": 104046.7305, "Lower": 36206.7618, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2014", "Mean": 68579.6072, "Upper": 122659.9375, "Lower": 40024.0147, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2013", "Mean": 66013.7437, "Upper": 116455.6982, "Lower": 38083.1708, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2012", "Mean": 68811.1921, "Upper": 123855.5568, "Lower": 39618.8108, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2011", "Mean": 83436.315, "Upper": 155937.3355, "Lower": 46372.9832, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2010", "Mean": 84164.4991, "Upper": 158067.3599, "Lower": 45896.2901, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2009", "Mean": 71516.8593, "Upper": 124254.1532, "Lower": 38303.6366, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2008", "Mean": 77441.72, "Upper": 144353.6496, "Lower": 43571.4409, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2007", "Mean": 86602.7662, "Upper": 160682.5521, "Lower": 46891.5418, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2006", "Mean": 98232.4639, "Upper": 193878.5414, "Lower": 51860.5897, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2005", "Mean": 99853.3481, "Upper": 202141.6208, "Lower": 52966.2531, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2004", "Mean": 91432.9528, "Upper": 184117.7327, "Lower": 47674.1459, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2003", "Mean": 80704.0309, "Upper": 161767.2747, "Lower": 42478.9309, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2002", "Mean": 72601.2137, "Upper": 142186.403, "Lower": 37280.5329, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2001", "Mean": 61752.5595, "Upper": 123054.4567, "Lower": 33385.0028, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2000", "Mean": 43628.5869, "Upper": 82883.9371, "Lower": 23382.7058, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1999", "Mean": 25117.3632, "Upper": 46388.6762, "Lower": 14239.0122, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1998", "Mean": 14144.5907, "Upper": 23255.0058, "Lower": 8351.3676, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1997", "Mean": 9270.9197, "Upper": 15496.6488, "Lower": 5932.7183, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1996", "Mean": 7328.9752, "Upper": 11422.8434, "Lower": 4821.1556, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1995", "Mean": 5822.3894, "Upper": 9013.9861, "Lower": 3837.4404, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1994", "Mean": 3811.7901, "Upper": 5683.5753, "Lower": 2598.4625, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1993", "Mean": 2248.6143, "Upper": 3093.2911, "Lower": 1607.1619, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1992", "Mean": 1454.8165, "Upper": 1982.4771, "Lower": 1079.3656, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1991", "Mean": 814.379, "Upper": 1105.0769, "Lower": 595.7274, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1990", "Mean": 346.8222, "Upper": 464.178, "Lower": 254.3226, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1989", "Mean": 150.9992, "Upper": 203.9152, "Lower": 110.0979, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1988", "Mean": 79.3057, "Upper": 117.9364, "Lower": 53.6655, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1987", "Mean": 73.3791, "Upper": 123.2312, "Lower": 44.3043, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1986", "Mean": 59.467, "Upper": 109.0807, "Lower": 32.7576, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1985", "Mean": 50.7051, "Upper": 106.0474, "Lower": 24.5939, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1984", "Mean": 37.3132, "Upper": 85.1134, "Lower": 17.0187, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1983", "Mean": 32.6492, "Upper": 78.1659, "Lower": 13.9408, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1982", "Mean": 46.2334, "Upper": 137.3491, "Lower": 17.8817, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "1981", "Mean": 58.5772, "Upper": 166.3098, "Lower": 19.9034, "Cohort": "Popart-Zambia-Copperbelt"},
                        {"Date": "2020", "Mean": 21937.0731, "Upper": 71317.4475, "Lower": 7287.2481, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2019", "Mean": 22350.8042, "Upper": 40151.8643, "Lower": 12833.163, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2018", "Mean": 31194.9438, "Upper": 52711.2091, "Lower": 19355.5117, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2017", "Mean": 26267.5408, "Upper": 43584.6488, "Lower": 16105.9606, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2016", "Mean": 29816.5725, "Upper": 51607.5938, "Lower": 17021.4772, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2015", "Mean": 37717.599, "Upper": 69070.0287, "Lower": 20217.862, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2014", "Mean": 28131.6751, "Upper": 49990.4841, "Lower": 16034.2049, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2013", "Mean": 24466.1067, "Upper": 43270.1901, "Lower": 14359.4758, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2012", "Mean": 33880.3416, "Upper": 65910.6936, "Lower": 18481.4143, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2011", "Mean": 46275.844, "Upper": 96984.4729, "Lower": 23920.2114, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2010", "Mean": 51037.396, "Upper": 108795.3377, "Lower": 26048.4393, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2009", "Mean": 50310.1189, "Upper": 103142.2226, "Lower": 24916.7217, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2008", "Mean": 49389.3522, "Upper": 104780.2227, "Lower": 24187.8383, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2007", "Mean": 45721.3596, "Upper": 94833.6324, "Lower": 22076.371, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2006", "Mean": 52320.1769, "Upper": 110819.3389, "Lower": 24229.219, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2005", "Mean": 65637.8316, "Upper": 149308.8776, "Lower": 29630.9591, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2004", "Mean": 61608.9052, "Upper": 143296.3233, "Lower": 27938.784, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2003", "Mean": 44058.301, "Upper": 94984.7352, "Lower": 21030.8399, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2002", "Mean": 37568.1697, "Upper": 78219.8044, "Lower": 18338.5223, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2001", "Mean": 37897.2985, "Upper": 82664.4004, "Lower": 18183.3049, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2000", "Mean": 30466.589, "Upper": 63581.6848, "Lower": 14420.7887, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1999", "Mean": 20307.6577, "Upper": 39750.2509, "Lower": 10247.8425, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1998", "Mean": 13962.4968, "Upper": 26577.3639, "Lower": 7275.5633, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1997", "Mean": 9067.4289, "Upper": 17093.0557, "Lower": 5112.5247, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1996", "Mean": 5655.011, "Upper": 9528.9471, "Lower": 3259.495, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1995", "Mean": 3977.8841, "Upper": 6642.7557, "Lower": 2528.934, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1994", "Mean": 2676.6232, "Upper": 4346.0974, "Lower": 1740.2471, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1993", "Mean": 1542.2991, "Upper": 2323.2006, "Lower": 1053.5266, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1992", "Mean": 828.6717, "Upper": 1168.6885, "Lower": 607.6703, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1991", "Mean": 441.4475, "Upper": 639.5177, "Lower": 303.8793, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1990", "Mean": 193.8866, "Upper": 271.1887, "Lower": 138.2703, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1989", "Mean": 81.9321, "Upper": 130.072, "Lower": 53.7527, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1988", "Mean": 42.9297, "Upper": 66.4438, "Lower": 27.2213, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1987", "Mean": 37.3066, "Upper": 68.7539, "Lower": 20.5563, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1986", "Mean": 21.3543, "Upper": 46.2427, "Lower": 10.162, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1985", "Mean": 20.022, "Upper": 46.6183, "Lower": 8.5772, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1984", "Mean": 35.6056, "Upper": 104.045, "Lower": 12.0846, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1983", "Mean": 52.4539, "Upper": 185.6778, "Lower": 16.352, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1982", "Mean": 66.3907, "Upper": 272.3201, "Lower": 19.1443, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "1981", "Mean": 79.4007, "Upper": 340.4026, "Lower": 20.7271, "Cohort": "Popart-Zambia-Central"},
                        {"Date": "2020", "Mean": 28975.0818, "Upper": 89831.3046, "Lower": 9763.6208, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2019", "Mean": 39551.1785, "Upper": 70729.9266, "Lower": 22338.2227, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2018", "Mean": 59774.8217, "Upper": 109131.2173, "Lower": 34542.1212, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2017", "Mean": 45019.2533, "Upper": 76538.6333, "Lower": 26270.6898, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2016", "Mean": 42804.5649, "Upper": 76925.7975, "Lower": 25365.607, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2015", "Mean": 47617.4409, "Upper": 86908.7219, "Lower": 27054.6066, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2014", "Mean": 44627.8839, "Upper": 83287.5576, "Lower": 25841.8578, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2013", "Mean": 42151.0782, "Upper": 80752.9262, "Lower": 23582.1782, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2012", "Mean": 41140.4572, "Upper": 75981.2064, "Lower": 22161.4367, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2011", "Mean": 43724.6827, "Upper": 82984.8341, "Lower": 24418.3932, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2010", "Mean": 54641.4825, "Upper": 101509.1665, "Lower": 27389.5228, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2009", "Mean": 56631.9093, "Upper": 112125.0272, "Lower": 28837.4703, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2008", "Mean": 57729.1074, "Upper": 114449.8056, "Lower": 29516.8771, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2007", "Mean": 72836.0669, "Upper": 152651.5023, "Lower": 34146.5554, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2006", "Mean": 89138.1582, "Upper": 195536.2964, "Lower": 41220.3357, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2005", "Mean": 93068.3007, "Upper": 212165.8518, "Lower": 42465.748, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2004", "Mean": 86605.8697, "Upper": 201380.6608, "Lower": 39527.0435, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2003", "Mean": 68862.2811, "Upper": 153552.421, "Lower": 32248.4042, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2002", "Mean": 45416.228, "Upper": 98976.6881, "Lower": 22398.7508, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2001", "Mean": 28195.4444, "Upper": 54776.6307, "Lower": 14686.1114, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "2000", "Mean": 20909.8425, "Upper": 39298.1513, "Lower": 11477.8472, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1999", "Mean": 16633.8565, "Upper": 31190.588, "Lower": 9426.7418, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1998", "Mean": 12711.7697, "Upper": 23174.9237, "Lower": 7160.0953, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1997", "Mean": 7977.1641, "Upper": 13783.7826, "Lower": 4697.4715, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1996", "Mean": 4470.4262, "Upper": 7577.8809, "Lower": 2793.387, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1995", "Mean": 3423.4808, "Upper": 5824.2142, "Lower": 2193.9793, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1994", "Mean": 2214.9946, "Upper": 3422.6033, "Lower": 1485.6823, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1993", "Mean": 1386.479, "Upper": 1968.4359, "Lower": 985.4909, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1992", "Mean": 918.0157, "Upper": 1310.2305, "Lower": 647.38, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1991", "Mean": 420.763, "Upper": 630.2874, "Lower": 294.3283, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1990", "Mean": 165.7344, "Upper": 233.8289, "Lower": 120.336, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1989", "Mean": 67.2467, "Upper": 104.1365, "Lower": 42.5871, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1988", "Mean": 29.0295, "Upper": 48.9083, "Lower": 17.7797, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1987", "Mean": 21.2491, "Upper": 40.7947, "Lower": 11.012, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1986", "Mean": 13.7499, "Upper": 28.4202, "Lower": 6.3104, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1985", "Mean": 17.1036, "Upper": 46.4897, "Lower": 6.5233, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1984", "Mean": 27.3925, "Upper": 97.6257, "Lower": 9.4011, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1983", "Mean": 33.9101, "Upper": 123.6286, "Lower": 9.6172, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1982", "Mean": 37.5152, "Upper": 153.2054, "Lower": 10.2994, "Cohort": "Popart-Zambia-Southern"},
                        {"Date": "1981", "Mean": 39.6124, "Upper": 190.7561, "Lower": 9.9245, "Cohort": "Popart-Zambia-Southern"}
                    ]
                },
            "layer": [
                {"mark": {"type": "area","opacity": 0.15},
                "params": [{
                    "name": "errorband",
                    "select": {"type": "point", "fields": ["Cohort"]},
                    "bind": "legend"
                }],
                "encoding": {
                    "y": {
                    "field": "Upper",
                    "type": "quantitative",
                    "axis": {
                        "title":"Skygrid Plot Log Scale",
                        "ticks":false},
                        "scale": { "type": "log", "domain": [1, 1000000]}},
                    "y2": {"field": "Lower"},
                    "x": {"field": "Date","type": "temporal"},
                    "color": {"field":"Cohort","scale": {"type": "ordinal"}},
                    "opacity": {
                        "condition": {"param": "errorband", "value": 0.25},
                        "value": 0.1
                        } 
                    }
                },
                {
                "encoding": {
                    "x": {
                        "field": "Date",
                        "type": "temporal",
                        "scale": {"domain": ["1981", "2020"]}},
                    "y": {
                        "field": "Mean", 
                        "type": "quantitative",
                        "scale": { "type": "log", "domain": [1, 1000000]}},
                    "color": {"field":"Cohort","scale": {"type": "ordinal"}},
                    "opacity": {
                        "condition": {"param": "errorband", "value": 1.0},
                        "value": 0.1
                        } 
                    },
                "layer": [
                    {"mark": "line"},
                    {"transform": [{"filter": {"param": "hover", "empty": false}}], "mark": "point"}
                ]},
                {
                "transform": [{"pivot": "Cohort", "value": "Mean", "groupby": ["Date"]}],
                "mark": "rule",
                    "params": [{
                    "name": "hover",
                    "select": {
                        "type": "point",
                        "fields": ["Date"],
                        "nearest": true,
                        "on": "mouseover",
                        "clear": "mouseout"
                        }
                    }],
                "encoding": {
                    "opacity": {
                    "condition": {"value": 0.3, "param": "hover", "empty": false},
                    "value": 0
                    },
                    "tooltip": [
                    {"field": "Popart-Zambia-Central", "type": "quantitative"},
                    {"field": "Popart-Zambia-Copperbelt", "type": "quantitative"},
                    {"field": "Popart-Zambia-Southern", "type": "quantitative"}
                    ]
                    }
                }
            ]
		};

     // Embed the visualization in the container with id `vis`
	vegaEmbed('#vis', vlSpec);

    </script>
  </body>
</html>
